---
/**
 * Performance optimization component
 * Implements prefetch strategies, resource hints, and performance monitoring
 */

import { generateResourceHints } from '../../utils/performance';
import performanceScriptUrl from './performance.client.ts?url';

// Generate resource hints for critical resources
const resourceHints = generateResourceHints();
const nonce = Astro.locals?.nonce;
---

<!-- DNS Prefetch for external domains -->
<link rel="dns-prefetch" href="//fonts.googleapis.com" />
<link rel="dns-prefetch" href="//fonts.gstatic.com" />
<link rel="dns-prefetch" href="//www.googletagmanager.com" />
<link rel="dns-prefetch" href="//www.google-analytics.com" />

<!-- Preconnect to critical external domains -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

<!-- Resource hints for critical assets -->
{resourceHints.map((hint) => (
  hint.as ? (
    <link
      rel="preload"
      href={hint.href}
      as={hint.as}
      type={hint.type}
      crossorigin={hint.crossorigin}
      media={hint.media}
    />
  ) : (
    <link rel="preconnect" href={hint.href} crossorigin={hint.crossorigin} />
  )
))}

<!-- Performance optimization scripts -->
<script
  type="module"
  src={performanceScriptUrl}
  nonce={nonce}
></script>

<!-- Critical CSS optimization -->
<style nonce={nonce}>
  /* Critical above-the-fold styles */
  html {
    font-display: swap; /* Ensure text remains visible during font load */
  }
  
  /* Optimize CLS by providing image placeholders */
  img {
    height: auto;
    max-width: 100%;
  }
  
  /* Prevent layout shift for loading images */
  img[loading="lazy"] {
    background-color: #f0f0f0;
    background-image: linear-gradient(45deg, transparent 49%, rgba(255,255,255,0.1) 50%, transparent 51%);
  }
</style>

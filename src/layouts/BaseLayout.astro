---
/**
 * BaseLayout - Core HTML structure with SEO
 * 
 * Uses community plugins:
 * - astro-seo: Meta tags, Open Graph, Twitter Cards
 * - astro-seo-schema: JSON-LD structured data
 */
import { SEO, type Props as SEOProps } from 'astro-seo';
import { Schema } from 'astro-seo-schema';
import type { Thing, WithContext } from 'schema-dts';

// Components
import CommonMeta from '@/components/seo/CommonMeta.astro';
import Favicons from '@/components/seo/Favicons.astro';
import SiteVerification from '@/components/analytics/SiteVerification.astro';
import TagManager from '@/components/analytics/TagManager.astro';
import WebVitals from '@/components/analytics/WebVitals.astro';

// Styles
import '@/styles/global.css';

// Site config
const SITE_NAME = 'Technical SEO Starter';
const SITE_URL = Astro.site?.toString() || 'https://example.com';

export interface Props {
  title: string;
  description: string;
  image?: string;
  noindex?: boolean;
  schema?: WithContext<Thing> | WithContext<Thing>[];
}

const { 
  title, 
  description, 
  image = '/og-image.png',
  noindex = false,
  schema,
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, SITE_URL).toString();
const ogImageURL = new URL(image, SITE_URL).toString();

// SEO props for astro-seo
const seoProps: SEOProps = {
  title,
  description,
  canonical: canonicalURL,
  noindex,
  openGraph: {
    basic: {
      title,
      type: 'website',
      image: ogImageURL,
      url: canonicalURL,
    },
    optional: {
      description,
      siteName: SITE_NAME,
      locale: 'en_US',
    },
    image: {
      alt: title,
      width: 1200,
      height: 630,
    },
  },
  twitter: {
    card: 'summary_large_image',
    title,
    description,
    image: ogImageURL,
    imageAlt: title,
  },
};
---

<!doctype html>
<html lang="en">
  <head>
    <CommonMeta />
    <Favicons />
    <SEO {...seoProps} />
    
    {schema && (
      Array.isArray(schema) 
        ? schema.map(s => <Schema item={s} />)
        : <Schema item={schema} />
    )}
    
    <SiteVerification />
    <TagManager />
    <WebVitals />
  </head>
  <body>
    <slot />
  </body>
</html>